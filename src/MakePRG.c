#include <stdio.h>
#include "git-banned.h"

static void writeProgram(const char *fname, const unsigned char *program, int len) {
    FILE *file = fopen(fname, "w");
    if (file == NULL) {
        perror("Error opening object file");
        return;
    }
    size_t bytesWritten = fwrite(program, 1, len, file);
    if (bytesWritten != len)
        perror("Error writing object file");
    fclose(file);
}

int main(void) {
    unsigned char prg[] = {
         0x00,  0x40, // little-endian start address of $4000 (16384)
         0xAE,  0x34,  0x40,  0xAD,  0x35,  0x40,  0x20,  0x2B,
         0x40,  0xAE,  0x36,  0x40,  0xAD,  0x37,  0x40,  0x20,
         0x2B,  0x40,  0x18,  0xAD,  0x36,  0x40,  0x6D,  0x34,
         0x40,  0x8D,  0x38,  0x40,  0xAD,  0x37,  0x40,  0x6D,
         0x35,  0x40,  0x8D,  0x39,  0x40,  0xAE,  0x38,  0x40,
         0xAD,  0x39,  0x40,  0x20,  0xCD,  0xBD,  0xA9,  0x0D,
         0x4C,  0xD2,  0xFF,  0x60,  0x42,  0x0E,  0xC1,  0x04,
         0x00,  0x00
    };
    int prglen = sizeof prg  / sizeof(prg[0]);

    unsigned char prg2[] = {
         0x00,  0xfe,
         0x48,  0x8a,  0x48,  0x98,  0x48,  0xa4,
         0xf6,  0xb9,  0x1c,  0xfe,  0x18,  0x65,  0xf5,  0x85,
         0xf7,  0xb9,  0x35,  0xfe,  0x69,  0x00,  0x85,  0xf8,
         0x68,  0xa8,  0x68,  0xaa,  0x68,  0x60,  0x00,  0x50,
         0xa0,  0xf0,  0x40,  0x90,  0xe0,  0x30,  0x80,  0xd0,
         0x20,  0x70,  0xc0,  0x10,  0x60,  0xb0,  0x00,  0x50,
         0xa0,  0xf0,  0x40,  0x90,  0xe0,  0x30,  0x80,  0xf0,
         0xf0,  0xf0,  0xf0,  0xf1,  0xf1,  0xf1,  0xf2,  0xf2,
         0xf2,  0xf3,  0xf3,  0xf3,  0xf4,  0xf4,  0xf4,  0xf5,
         0xf5,  0xf5,  0xf5,  0xf6,  0xf6,  0xf6,  0xf7,  0xf7,
         0xc9,  0x08,  0xf0,  0x27,  0xc9,  0x0a,  0xf0,  0x3d,
         0xc9,  0x0d,  0xf0,  0x39,  0xc9,  0x80,  0xf0,  0x7c,
         0xc9,  0x81,  0xf0,  0x3b,  0xc9,  0x82,  0xf0,  0x64,
         0xc9,  0x83,  0xf0,  0x45,  0x20,  0x00,  0xfe,  0x84,
         0xfd,  0xa0,  0x00,  0x91,  0xf7,  0x20,  0x9d,  0xfe,
         0xa4,  0xfd,  0x60,  0x48,  0x98,  0x48,  0x8a,  0x48,
         0x20,  0xaf,  0xfe,  0x20,  0x00,  0xfe,  0xa0,  0x00,
         0xa9,  0x20,  0x91,  0xf7,  0xa6,  0x50,  0xca,  0x68,
         0xaa,  0x68,  0xa8,  0x68,  0x60,  0x48,  0xa9,  0x00,
         0x85,  0xf5,  0x20,  0xca,  0xfe,  0x68,  0x60,  0x48,
         0xe6,  0xf5,  0xa9,  0x50,  0xc5,  0xf5,  0xd0,  0x07,
         0xa9,  0x00,  0x85,  0xf5,  0x20,  0xca,  0xfe,  0x68,
         0x60,  0x48,  0xc6,  0xf5,  0x10,  0x14,  0xa5,  0xf6,
         0xf0,  0x0a,  0xa9,  0x50,  0x85,  0xf5,  0x20,  0xda,
         0xfe,  0x18,  0x90,  0x06,  0xa9,  0x00,  0x85,  0xf5,
         0x85,  0xf6,  0x68,  0x60,  0x48,  0xe6,  0xf6,  0xa9,
         0x19,  0xc5,  0xf6,  0xd0,  0x05,  0x20,  0x2f,  0xff,
         0xc6,  0xf6,  0x68,  0x60,  0xc6,  0xf6,  0x10,  0x02,
         0xe6,  0xf6,  0x60,  0x48,  0x98,  0x48,  0xa9,  0x00,
         0x85,  0xf5,  0x85,  0xf6,  0x20,  0x00,  0xfe,  0xa0,
         0x00,  0xa9,  0x20,  0x91,  0xf7,  0xc8,  0xd0,  0xfb,
         0xe6,  0xf8,  0xa5,  0xf8,  0xc9,  0xf8,  0xd0,  0xf1,
         0x20,  0x00,  0xfe,  0x68,  0x98,  0x68,  0x60,  0xa5,
         0xff,  0xf0,  0x06,  0x48,  0xa9,  0x00,  0x85,  0xff,
         0x68,  0x60,  0xa0,  0x19,  0xa2,  0x50,  0x60,  0xb0,
         0x0c,  0x86,  0xf5,  0x84,  0xf6,  0x20,  0x00,  0xfe,
         0xa4,  0xf8,  0xa5,  0xf7,  0x60,  0x20,  0x00,  0xfe,
         0xa0,  0x00,  0xb1,  0xf7,  0xa6,  0xf5,  0xa4,  0xf6,
         0x60,  0x48,  0x98,  0x48,  0xa9,  0x00,  0x85,  0xfb,
         0xa9,  0x50,  0x85,  0xf9,  0xa9,  0xf0,  0x85,  0xfa,
         0x85,  0xfc,  0xa0,  0x00,  0xb1,  0xf9,  0x91,  0xfb,
         0xc8,  0xd0,  0xf9,  0xe6,  0xfa,  0xe6,  0xfc,  0xa9,
         0xf7,  0xc5,  0xfa,  0xd0,  0xef,  0xb1,  0xf9,  0x91,
         0xfb,  0xc8,  0xc0,  0x80,  0xd0,  0xf7,  0xa0,  0x00,
         0xa9,  0x20,  0x99,  0x80,  0xf7,  0xc8,  0xc0,  0x50,
         0xd0,  0xf8,  0x68,  0xa8,  0x68,  0x60,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x4c,  0xe1,  0xfe,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x4c,  0x05,  0xff,  0x4c,  0x4e,  0xfe,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x4c,
         0x10,  0xff,  0x4c,  0x15,  0xff,  0x00,  0x00,  0x00,
         0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,  0x00,
         0x00,  0x00
    };
    int prg2len = sizeof prg2 / sizeof(prg2[0]);

    printf("prg %p, sizeof prg %lu, prglen %d\n", prg, sizeof prg, prglen);
    printf("prg2 %p, sizeof prg %lu, prg2len %d\n", prg2, sizeof prg2, prg2len);

    // Open the output file - this is a genuine 6510 program at $4000 (16384)
    // Once this file is created you can drop the file onto the C-64 emulator
    writeProgram("../examples/rom.prg", prg, prglen);

}
